<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
<mapper namespace="UserMapper">

	<resultMap id="userSelectMap" type="user" >
		<result property="userId"                     column="USER_ID"             jdbcType="VARCHAR"/>
		<result property="employeeNo"         column="EMPLOYEE_NO"         jdbcType="VARCHAR"/>
		<result property="branchNo"                    column="BRANCH_NO"            jdbcType="VARCHAR"/>
		<result property="password"                   column="PASSWORD"           jdbcType="VARCHAR"/>
		<result property="memberCodeNo"               column="MEMBER_CODE_NO"         jdbcType="VARCHAR"/>
		<result property="memberCodeName"           column="MEMBER_CODE_NAME"                    jdbcType="VARCHAR"/>
		<result property="memberUsageStatusCodeNo"     column="USAGE_STATUS_CODE_NO"       jdbcType="VARCHAR"/>
		<result property="accessMenuCodeNo"           column="ACCESS_MENU_CODE_NO"               jdbcType="VARCHAR"/>
	</resultMap>

	<insert id="insertUser" parameterType="user">
		INSERT
		  INTO	users
		  			(
		  			USER_ID,
		  			EMPLOYEE_NO,
		  			PASSWORD,
		  			BRANCH_NO,
		  			MEMBER_CODE_NO,
		  			USAGE_STATUS_CODE_NO,
		  			ACCESS_MENU_CODE_NO
		  			)
		VALUES	
				(
					#{userId},
					#{employeeNo:VARCHAR},
					#{password},
					#{branchNo:VARCHAR},
					#{memberCodeNo},
					#{memberUsageStatusCodeNo},
					#{accessMenuCodeNo}
				)
	</insert>
	
	<select id="selectUserList" resultMap="userSelectMap">  
		SELECT	USER_ID,
				EMPLOYEE_NO,
				PASSWORD,
				BRANCH_NO,
				MEMBER_CODE_NO,
				CODE_FUNCTION('member', MEMBER_CODE_NO) AS MEMBER_CODE_NAME,
				USAGE_STATUS_CODE_NO,
				ACCESS_MENU_CODE_NO 
		  FROM	users
	</select>
	
	
	<select 	id="selectUser"	parameterType="String"	resultMap="userSelectMap">
		SELECT	USER_ID,
				EMPLOYEE_NO,
				PASSWORD,
				BRANCH_NO,
				MEMBER_CODE_NO,
				CODE_FUNCTION('member', MEMBER_CODE_NO) AS MEMBER_CODE_NAME,
				USAGE_STATUS_CODE_NO,
				ACCESS_MENU_CODE_NO 
		  FROM	users
		WHERE user_id = #{value}
	 </select>
	
	<update id="modifyPassword" parameterType="user" >
		UPDATE users
		<set>
			PASSWORD = #{password}
		</set>
		WHERE USER_ID = #{userId}
	</update>
	
	<select 	id="proofMySelfForId1"	parameterType="humanResourceCard"	resultType="String">
		SELECT	USER_ID
		  FROM	users join human_resource_card on users.employee_no = human_resource_card.employee_no
		  WHERE  EMPLOYEE_NAME = #{employeeName} AND
		  		 EMPLOYEE_PHONE = #{employeePhone}
	 </select>
	 
	 <select 	id="proofMySelfForPassword1"	   parameterType="humanResourceCard"	  resultType="String">
		SELECT  PASSWORD
		  FROM	users join human_resource_card on users.employee_no = human_resource_card.employee_no
		 WHERE  EMPLOYEE_NAME = #{employeeName} AND
		  		 EMPLOYEE_PHONE = #{employeePhone}
	 </select>
	 
	 <select 	id="proofMySelfForId2"	parameterType="branch"	resultType="String">
		SELECT	USER_ID
		  FROM	users join branch on users.branch_no = branch.branch_No
		  WHERE  BRANCH_MANAGER_NAME = #{branchManagerName} AND
		  		 BRANCH_MANAGER_PHONE = #{branchManagerPhone}
	 </select>
	 
	 <select 	id="proofMySelfForPassword2"	   parameterType="branch"	  resultType="String">
		SELECT  PASSWORD
		  FROM	users join branch on users.branch_no = branch.branch_No
		 WHERE  BRANCH_MANAGER_NAME = #{branchManagerName} AND
		  		 BRANCH_MANAGER_PHONE = #{branchManagerPhone}
	 </select>
	
	

</mapper>